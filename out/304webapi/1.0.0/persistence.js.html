<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: persistence.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: persistence.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict'
const schema = require('../Schema/Schema')

/**
*Saves Movie To DB Based On Data Return
*@function
*@Param {String} movieData - Data exported From addMovie 
*@Param {String} callback - Adding Confirmation
*@Returns {JSON} Movie Data Added
*@throws Will throw error if omdb server is down
*@throws Will throw error if mlab is down
*@throws Will throw error if trying to add a duplicate movie
*/
exports.saveMovie = (movieData, callback) => {
	const movie = new schema.Movie(movieData)

	schema.Movie.find({
		imdbID: movieData.imdbID
	}, function(err, movies) {
        /* istanbul ignore next */
		if (err) {
			callback(new Error(err))
		}
		if (movies.length === 0) {
			movie.save((err, movie) => {
                /* istanbul ignore next */
				if (err) {
					callback(new Error('Could not save movie'))
				}
				callback(null, movie)
			})
		}		else {
			callback('Denied as duplicate')
		}
	})
}
/**
*Shows Movies In Favourites List
*@function
*@Param {String} callback - Favourites List
*@Returns {JSON} Movie Data In Favourites List
*@throws Will throw error if mlab is down
*/
exports.showFavourites = function(callback) {
	schema.Movie.find({}, function(err, movies) {
        /* istanbul ignore next */
		if (err) {
			callback(new Error(err))
		} else {
			callback(null, movies)
		}
	})
}
/**
*Shows Specific Movie In Favourites List
*@function
*@Param {String} id - Movie imdbID
*@Param {String} callback - Movie Data
*@Returns {JSON} Specific Movie Data From Favourites
*@throws Will throw error if mlab is down
*@throws Will throw error if Id entered doesn't exist in the list
*/
exports.showFavouritebyid = function(id,callback) {
	schema.Movie.find({
		imdbID: id
	}, function(err, movies) {
        /* istanbul ignore next */
		if (err) {
			callback(new Error(err))
		}
		if (movies.length === 0) {
			callback(new Error('Id Not In Database'))
		} else {
			callback(null, movies[0])
		}
	})
}
/**
*Removes Specific Movie In Favourites List
*@function
*@Param {String} id - Movie imdbID
*@Param {String} callback - Removal Confirmation
*@Returns {JSON} Removal Confirmation
*@throws Will throw error if Id entered invalid
*@throws Will throw error if mlab is down
*/
exports.remove = function(id, callback) {
	if (id.length === 0) {
		callback(new Error('Pass a valid id'))
	} else {
		schema.Movie.remove({
			imdbID: id
		}, function(err, movies) {
        /* istanbul ignore next */
			if (err) {
				callback(new Error(err))
			} else {
				callback(null, movies)
			}
		})
	}
}
/**
*Updates imdbRating To A Specific Movie
*@function
*@Param {String} id - Movie imdbID
*@Param {String} imdbRating - New Movie imdbRating
*@Param {String} callback - Old Movie Data
*@Returns {JSON} Update Confirmation
*@throws Will throw error if Id or imdbRating entered invalid
*@throws Will throw error if mlab is down
*@throws Will throw error if id is not in favourites list
*/
exports.updaterating = function(id, imdbRating, callback) {
	if (id === undefined || imdbRating === undefined) {
		return callback(new Error('Pass a valid id'))
	}	else {
		schema.Movie.findOneAndUpdate({imdbID: id}, {'imdbRating': imdbRating
		}, function(err, movies) {
        /* istanbul ignore next */
			if (err) {
				return callback(new Error(err))
			}
			if (movies === null) {
				callback(new Error('Not in Database'))
			}	else {
				callback(null, movies)
			}
		})
	}
}


</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addMovie">addMovie</a></li><li><a href="global.html#getMovie">getMovie</a></li><li><a href="global.html#remove">remove</a></li><li><a href="global.html#saveMovie">saveMovie</a></li><li><a href="global.html#searchMovie">searchMovie</a></li><li><a href="global.html#showFavouritebyid">showFavouritebyid</a></li><li><a href="global.html#showFavourites">showFavourites</a></li><li><a href="global.html#updaterating">updaterating</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Mon Dec 12 2016 17:43:46 GMT+0000 (GMT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
